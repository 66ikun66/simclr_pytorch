# SimCLR é¡¹ç›®å®Œæ•´ä½¿ç”¨æŒ‡å—

> **ä½œè€…**: GitHub Copilot  
> **æ—¥æœŸ**: 2025å¹´11æœˆ17æ—¥  
> **ç¯å¢ƒ**: Windows + Anaconda (simclr_pytorch)  
> **GPU**: NVIDIA GeForce RTX 5060 Laptop GPU

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
2. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
3. [è®­ç»ƒæµç¨‹](#è®­ç»ƒæµç¨‹)
4. [æŸ¥çœ‹ç»“æœ](#æŸ¥çœ‹ç»“æœ)
5. [ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹](#ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)

---

## ğŸ¯ é¡¹ç›®ç®€ä»‹

**SimCLR (Simple Framework for Contrastive Learning of Visual Representations)** æ˜¯ä¸€ä¸ªè‡ªç›‘ç£å­¦ä¹ æ¡†æ¶ï¼Œé€šè¿‡å¯¹æ¯”å­¦ä¹ æ¥å­¦ä¹ å›¾åƒçš„è¡¨ç¤ºï¼Œæ— éœ€æ ‡æ³¨æ•°æ®å³å¯è®­ç»ƒå‡ºå¼ºå¤§çš„ç‰¹å¾æå–å™¨ã€‚

### æ ¸å¿ƒç‰¹ç‚¹
- âœ… **è‡ªç›‘ç£å­¦ä¹ **: ä¸éœ€è¦æ ‡æ³¨æ•°æ®
- âœ… **å¯¹æ¯”å­¦ä¹ **: é€šè¿‡æ•°æ®å¢å¼ºåˆ›å»ºæ­£è´Ÿæ ·æœ¬å¯¹
- âœ… **è¿ç§»å­¦ä¹ **: å¯ç”¨äºå„ç§ä¸‹æ¸¸è§†è§‰ä»»åŠ¡
- âœ… **GPU åŠ é€Ÿ**: æ”¯æŒ CUDA åŠ é€Ÿè®­ç»ƒ

### é¡¹ç›®ç»“æ„
```
simclr-pytorch/
â”œâ”€â”€ run.py                          # åŸå§‹è®­ç»ƒå…¥å£
â”œâ”€â”€ simple_run.py                   # ç®€åŒ–è®­ç»ƒè„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”œâ”€â”€ simclr.py                       # SimCLR æ ¸å¿ƒè®­ç»ƒé€»è¾‘
â”œâ”€â”€ utils.py                        # å·¥å…·å‡½æ•°
â”œâ”€â”€ models/
â”‚   â””â”€â”€ resnet_simclr.py           # ResNet æ¨¡å‹å®šä¹‰
â”œâ”€â”€ data_aug/
â”‚   â”œâ”€â”€ contrastive_learning_dataset.py  # æ•°æ®é›†åŠ è½½
â”‚   â”œâ”€â”€ gaussian_blur.py           # é«˜æ–¯æ¨¡ç³Šå¢å¼º
â”‚   â””â”€â”€ view_generator.py          # è§†å›¾ç”Ÿæˆå™¨
â”œâ”€â”€ datasets/                       # æ•°æ®é›†å­˜å‚¨ç›®å½•
â”œâ”€â”€ runs/                          # è®­ç»ƒç»“æœå’Œæ—¥å¿—
â”œâ”€â”€ run_simclr.bat                 # ä¸€é”®è®­ç»ƒè„šæœ¬
â”œâ”€â”€ start_tensorboard.bat          # ä¸€é”®å¯åŠ¨ TensorBoard
â”œâ”€â”€ check_env.py                   # ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â”œâ”€â”€ view_results.py                # æŸ¥çœ‹è®­ç»ƒç»“æœ
â””â”€â”€ analyze_results.py             # è¯¦ç»†åˆ†ææ¨¡å‹
```

---

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

###  æ‰‹åŠ¨æ£€æŸ¥ï¼ˆå¯é€‰ï¼Œåç»­è®­ç»ƒæ—¶ç›´æ¥æ‰§è¡Œ.\run_simclr.batä¼šè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒï¼‰

å¦‚æœéœ€è¦æ‰‹åŠ¨ç¡®è®¤ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
# æŸ¥çœ‹æ‰€æœ‰ conda ç¯å¢ƒ
conda env list

# æ‰‹åŠ¨æ¿€æ´»ç¯å¢ƒ
conda activate simclr_pytorch

# æˆ–ä½¿ç”¨å®Œæ•´è·¯å¾„æ¿€æ´»
D:\Anaconda\Scripts\activate.bat simclr_pytorch

# æ£€æŸ¥ Python ç‰ˆæœ¬
python --version
```

###  éªŒè¯ä¾èµ–åŒ…

æ ¸å¿ƒä¾èµ–åŒ…ï¼š
- âœ… PyTorch >= 1.4.0
- âœ… TorchVision >= 0.5.0
- âœ… TensorBoard >= 2.1
- âœ… tqdm
- âœ… PyYAML

å¦‚æœç¼ºå°‘ä¾èµ–ï¼Œå¯ä»¥å®‰è£…ï¼š
```powershell
conda activate simclr_pytorch
pip install torch torchvision tensorboard tqdm pyyaml
```

---

## ğŸš€ è®­ç»ƒæµç¨‹

### æ–¹æ³• 1: ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆæœ€ç®€å•ï¼‰â­

**ä¸€é”®å¯åŠ¨è®­ç»ƒ**ï¼š

```powershell
# åŒå‡»æˆ–åœ¨ç»ˆç«¯è¿è¡Œ
.\run_simclr.bat
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. âœ… è‡ªåŠ¨æ¿€æ´» `simclr_pytorch` ç¯å¢ƒ
2. âœ… æ£€æŸ¥ Python å’Œ GPU é…ç½®
3. âœ… è¿è¡Œè®­ç»ƒè„šæœ¬
4. âœ… æ˜¾ç¤ºè®­ç»ƒè¿›åº¦

### æ–¹æ³• 2: ä½¿ç”¨ Python è„šæœ¬(æœ‰ä¹±ç ï¼Œä¸”æ— æ³•å®æ—¶æ˜¾ç¤ºè®­ç»ƒè¿›åº¦)

**å¿«é€Ÿæµ‹è¯•è®­ç»ƒï¼ˆ2 epochsï¼Œå¯ä¿®æ”¹ï¼‰**ï¼š

```powershell
conda run -n simclr_pytorch python simple_run.py
```

**ä½¿ç”¨åŸå§‹è„šæœ¬ï¼ˆæ›´å¤šè‡ªå®šä¹‰é€‰é¡¹ï¼‰**ï¼š

```powershell
conda run -n simclr_pytorch python run.py ^
  -data ./datasets ^
  -dataset-name cifar10 ^
  --arch resnet18 ^
  --epochs 100 ^
  --batch-size 128 ^
  --log-every-n-steps 50
```

### è®­ç»ƒå‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | æ¨èå€¼ |
|------|------|--------|--------|
| `-data` | æ•°æ®é›†è·¯å¾„ | `./datasets` | `./datasets` |
| `-dataset-name` | æ•°æ®é›†åç§° | `stl10` | `cifar10` æˆ– `stl10` |
| `--arch` | æ¨¡å‹æ¶æ„ | `resnet18` | `resnet18` æˆ– `resnet50` |
| `--epochs` | è®­ç»ƒè½®æ•° | `200` | 100-1000 |
| `--batch-size` | æ‰¹æ¬¡å¤§å° | `256` | 64-256ï¼ˆå–å†³äºGPUå†…å­˜ï¼‰|
| `--lr` | å­¦ä¹ ç‡ | `0.0003` | `0.0003` |
| `--temperature` | å¯¹æ¯”å­¦ä¹ æ¸©åº¦ | `0.07` | `0.07-0.1` |
| `--workers` | æ•°æ®åŠ è½½çº¿ç¨‹ | `12` | Windowså»ºè®® `0` |

### ä¿®æ”¹è®­ç»ƒé…ç½®

ç¼–è¾‘ `simple_run.py` ä¸­çš„ `Args` ç±»ï¼š

```python
class Args:
    def __init__(self):
        self.data = './datasets'
        self.dataset_name = 'cifar10'    # æ”¹ä¸º 'stl10' ä½¿ç”¨ STL-10
        self.arch = 'resnet18'           # æ”¹ä¸º 'resnet50' ä½¿ç”¨æ›´å¤§æ¨¡å‹
        self.workers = 0                 # Windows å¿…é¡»ä¸º 0
        self.epochs = 100                # ä¿®æ”¹è®­ç»ƒè½®æ•°
        self.batch_size = 128            # ä¿®æ”¹æ‰¹æ¬¡å¤§å°
        self.lr = 0.0003
        # ... å…¶ä»–å‚æ•°
```

### è®­ç»ƒè¿‡ç¨‹è¯´æ˜

1. **æ•°æ®å‡†å¤‡é˜¶æ®µ**
   ```
   å‡†å¤‡æ•°æ®é›†...
   æ•°æ®é›†åŠ è½½æˆåŠŸ! æ ·æœ¬æ•°: 50000
   ```
   - é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½ CIFAR-10 æ•°æ®é›†
   - æ•°æ®é›†ä¿å­˜åœ¨ `./datasets/` ç›®å½•

2. **æ¨¡å‹åˆå§‹åŒ–**
   ```
   åˆ›å»ºæ¨¡å‹...
   æ¨¡å‹åˆ›å»ºæˆåŠŸ!
   ```
   - åŠ è½½ ResNet-18 backbone
   - æ·»åŠ æŠ•å½±å¤´ï¼ˆProjection Headï¼‰

3. **è®­ç»ƒè¿›åº¦æ˜¾ç¤º**
   ```
   89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 695/781 [02:12<00:15, 5.70it/s]
   ```
   - æ˜¾ç¤ºå½“å‰è¿›åº¦ç™¾åˆ†æ¯”
   - å½“å‰æ‰¹æ¬¡ / æ€»æ‰¹æ¬¡æ•°
   - å·²ç”¨æ—¶é—´ / é¢„è®¡å‰©ä½™æ—¶é—´
   - å¤„ç†é€Ÿåº¦ï¼ˆæ‰¹æ¬¡/ç§’ï¼‰

4. **è®­ç»ƒæ—¥å¿—**
   - æ¯ N æ­¥è®°å½•ä¸€æ¬¡æŸå¤±å’Œå‡†ç¡®ç‡
   - è‡ªåŠ¨ä¿å­˜åˆ° TensorBoard
   - ä¿å­˜æ–‡æœ¬æ—¥å¿—åˆ° `runs/*/training.log`

### è®­ç»ƒæ—¶é—´ä¼°è®¡

åŸºäº RTX 5060 Laptop GPUï¼š

| æ•°æ®é›† | Epochs | æ‰¹æ¬¡å¤§å° | é¢„è®¡æ—¶é—´ |
|--------|--------|----------|----------|
| CIFAR-10 | 2 | 64 | ~5 åˆ†é’Ÿ |
| CIFAR-10 | 100 | 64 | ~4 å°æ—¶ |
| CIFAR-10 | 100 | 128 | ~2 å°æ—¶ |
| STL-10 | 100 | 64 | ~1.5 å°æ—¶ |

### åœæ­¢è®­ç»ƒ

- **ä¼˜é›…åœæ­¢**: æŒ‰ `Ctrl+C` ä¸€æ¬¡ï¼ˆä¼šä¿å­˜å½“å‰æ£€æŸ¥ç‚¹ï¼‰
- **å¼ºåˆ¶åœæ­¢**: æŒ‰ `Ctrl+C` ä¸¤æ¬¡ï¼ˆå¯èƒ½ä¸¢å¤±è¿›åº¦ï¼‰

---

## ğŸ“Š æŸ¥çœ‹ç»“æœ

è®­ç»ƒå®Œæˆåï¼Œæœ‰å¤šç§æ–¹å¼æŸ¥çœ‹å’Œåˆ†æç»“æœã€‚

### æ–¹æ³• 1: TensorBoard å¯è§†åŒ–ï¼ˆå¼ºçƒˆæ¨èï¼‰â­

**å¯åŠ¨ TensorBoard**:

```powershell
# æ–¹æ³• A: ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆæœ€ç®€å•ï¼‰
.\start_tensorboard.bat

# æ–¹æ³• B: æ‰‹åŠ¨å‘½ä»¤
conda run -n simclr_pytorch tensorboard --logdir=./runs
```

**è®¿é—®ç•Œé¢**:
- åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€: http://localhost:6006
- æˆ–è€…åœ¨ VS Code ä¸­æ‰“å¼€ç®€å•æµè§ˆå™¨

**TensorBoard åŠŸèƒ½**:

1. **SCALARS æ ‡ç­¾é¡µ** - æŸ¥çœ‹è®­ç»ƒæŒ‡æ ‡
   - ğŸ“‰ `loss`: å¯¹æ¯”å­¦ä¹ æŸå¤±æ›²çº¿
   - ğŸ“Š `acc/top1`: Top-1 å‡†ç¡®ç‡
   - ğŸ“Š `acc/top5`: Top-5 å‡†ç¡®ç‡
   - ğŸ“ˆ `learning_rate`: å­¦ä¹ ç‡å˜åŒ–

2. **æ“ä½œæŠ€å·§**
   - ğŸ” ç¼©æ”¾ï¼šæ»šè½®æˆ–æ‹–æ‹½
   - ğŸ“Œ å›ºå®š Y è½´ï¼šç‚¹å‡»å·¦ä¾§å›¾æ ‡
   - ğŸ”„ å¯¹æ¯”å¤šæ¬¡è¿è¡Œï¼šé€‰æ‹©ä¸åŒçš„è¿è¡Œè®°å½•
   - ğŸ’¾ ä¸‹è½½æ•°æ®ï¼šç‚¹å‡»å³ä¸Šè§’ä¸‹è½½æŒ‰é’®

**åœæ­¢ TensorBoard**:
- æŒ‰ `Ctrl+C` åœæ­¢æœåŠ¡å™¨

### æ–¹æ³• 2: æŸ¥çœ‹è®­ç»ƒæ‘˜è¦

è¿è¡Œç»“æœæŸ¥çœ‹å™¨ï¼š

.\view_training_results.bat

**è¾“å‡ºç¤ºä¾‹**:
```
======================================================================
SimCLR è®­ç»ƒç»“æœæŸ¥çœ‹å™¨
======================================================================

æ‰¾åˆ° 1 ä¸ªè®­ç»ƒè¿è¡Œè®°å½•:

1. Nov17_21-59-10_MyDevice
   æ—¶é—´: 2025-11-17 22:03:57
   æ—¥å¿—è¡Œæ•°: 6
   INFO:root:Start SimCLR training for 2 epochs.
   DEBUG:root:Epoch: 0  Loss: 4.114  Top1 accuracy: 12.5
   DEBUG:root:Epoch: 1  Loss: 3.490  Top1 accuracy: 17.97
   INFO:root:Training has finished.
   æ¨¡å‹æ£€æŸ¥ç‚¹: 1 ä¸ª
     - checkpoint_0002.pth.tar (131.80 MB)
```

### æ–¹æ³• 3: è¯¦ç»†æ¨¡å‹åˆ†æ

è¿è¡Œæ¨¡å‹åˆ†æè„šæœ¬ï¼š

.\analyze_model.bat

**è¾“å‡ºå†…å®¹**:
- âœ… æ£€æŸ¥ç‚¹æ–‡ä»¶ä¿¡æ¯
- âœ… æ¨¡å‹æ¶æ„è¯¦æƒ…
- âœ… æ€»å‚æ•°é‡ç»Ÿè®¡
- âœ… è®­ç»ƒé…ç½®æ€»ç»“
- âœ… ä½¿ç”¨ä»£ç ç¤ºä¾‹

### æ–¹æ³• 4: æŸ¥çœ‹æ–‡æœ¬æ—¥å¿—

ç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š

```powershell
# æŸ¥çœ‹æœ€æ–°çš„è®­ç»ƒæ—¥å¿—ï¼ˆå¯ä»¥æ‰‹åŠ¨åœ¨runsç›®å½•ä¸‹å¯»æ‰¾ï¼‰
type .\runs\Nov17_21-59-10_MyDevice\training.log
```

### è®­ç»ƒç»“æœè§£è¯»

#### æŸå¤±ï¼ˆLossï¼‰
- **åˆå§‹å€¼**: é€šå¸¸åœ¨ 4-5 ä¹‹é—´
- **ä¸‹é™è¶‹åŠ¿**: åº”è¯¥æŒç»­ä¸‹é™
- **æ”¶æ•›å€¼**: ç†æƒ³æƒ…å†µä¸‹é™åˆ° 2.5-3.5
- âš ï¸ **å¼‚å¸¸æƒ…å†µ**:
  - æŸå¤±ä¸ä¸‹é™ â†’ å­¦ä¹ ç‡å¯èƒ½å¤ªå°
  - æŸå¤±éœ‡è¡å‰§çƒˆ â†’ å­¦ä¹ ç‡å¯èƒ½å¤ªå¤§
  - æŸå¤±çªç„¶ä¸Šå‡ â†’ å¯èƒ½å‡ºç°æ•°å€¼ä¸ç¨³å®š

#### Top-1 å‡†ç¡®ç‡
- **è¿™ä¸æ˜¯åˆ†ç±»å‡†ç¡®ç‡ï¼** 
- è¿™æ˜¯å¯¹æ¯”å­¦ä¹ ä»»åŠ¡çš„å‡†ç¡®ç‡
- å…¸å‹å€¼: 10%-30%
- ä¸Šå‡è¶‹åŠ¿è¡¨ç¤ºæ¨¡å‹æ­£åœ¨å­¦ä¹ æœ‰æ•ˆçš„è¡¨ç¤º

#### çœŸå®æ€§èƒ½è¯„ä¼°
éœ€è¦è¿›è¡Œ**çº¿æ€§è¯„ä¼°**ï¼ˆLinear Evaluationï¼‰:
1. å†»ç»“ SimCLR ç¼–ç å™¨
2. åœ¨ç‰¹å¾ä¸Šè®­ç»ƒçº¿æ€§åˆ†ç±»å™¨
3. åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°åˆ†ç±»å‡†ç¡®ç‡

---

## ğŸ¯ ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹

### åŠ è½½é¢„è®­ç»ƒæ¨¡å‹

```python
import torch
from models.resnet_simclr import ResNetSimCLR

# 1. åˆ›å»ºæ¨¡å‹å®ä¾‹
model = ResNetSimCLR(base_model='resnet18', out_dim=128)

# 2. åŠ è½½è®­ç»ƒå¥½çš„æƒé‡
checkpoint_path = './runs/Nov17_21-59-10_MyDevice/checkpoint_0002.pth.tar'
checkpoint = torch.load(checkpoint_path, map_location='cpu')
model.load_state_dict(checkpoint['state_dict'])

# 3. è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼
model.eval()

# 4. ç§»åŠ¨åˆ° GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰
device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
model = model.to(device)

print("âœ“ æ¨¡å‹åŠ è½½æˆåŠŸ!")
print(f"âœ“ è®­ç»ƒè½®æ•°: {checkpoint['epoch']}")
print(f"âœ“ æ¨¡å‹æ¶æ„: {checkpoint['arch']}")
```

### ç”¨äºç‰¹å¾æå–

```python
import torch
from torchvision import transforms
from PIL import Image

# 1. å®šä¹‰å›¾åƒé¢„å¤„ç†
transform = transforms.Compose([
    transforms.Resize(256),
    transforms.CenterCrop(224),
    transforms.ToTensor(),
    transforms.Normalize(
        mean=[0.485, 0.456, 0.406],
        std=[0.229, 0.224, 0.225]
    )
])

# 2. åŠ è½½å¹¶é¢„å¤„ç†å›¾åƒ
image_path = 'path/to/your/image.jpg'
image = Image.open(image_path).convert('RGB')
image_tensor = transform(image).unsqueeze(0).to(device)

# 3. æå–ç‰¹å¾
with torch.no_grad():
    features = model(image_tensor)
    print(f"ç‰¹å¾ç»´åº¦: {features.shape}")  # [1, 128]
    print(f"ç‰¹å¾å‘é‡: {features}")
```

### æ‰¹é‡ç‰¹å¾æå–

```python
from torch.utils.data import DataLoader
from torchvision.datasets import CIFAR10

# 1. å‡†å¤‡æ•°æ®é›†
dataset = CIFAR10(
    root='./datasets',
    train=False,
    download=True,
    transform=transform
)

dataloader = DataLoader(
    dataset,
    batch_size=256,
    shuffle=False,
    num_workers=0
)

# 2. æå–æ‰€æœ‰ç‰¹å¾
all_features = []
all_labels = []

model.eval()
with torch.no_grad():
    for images, labels in dataloader:
        images = images.to(device)
        features = model(images)
        all_features.append(features.cpu())
        all_labels.append(labels)

# 3. åˆå¹¶ç»“æœ
all_features = torch.cat(all_features, dim=0)
all_labels = torch.cat(all_labels, dim=0)

print(f"æ€»ç‰¹å¾: {all_features.shape}")  # [10000, 128]
print(f"æ€»æ ‡ç­¾: {all_labels.shape}")    # [10000]
```

### ç”¨äºè¿ç§»å­¦ä¹ ï¼ˆåˆ†ç±»ä»»åŠ¡ï¼‰

```python
import torch.nn as nn
import torch.optim as optim

# 1. åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
model = ResNetSimCLR(base_model='resnet18', out_dim=128)
checkpoint = torch.load(checkpoint_path)
model.load_state_dict(checkpoint['state_dict'])

# 2. å†»ç»“ç‰¹å¾æå–å™¨ï¼ˆå¯é€‰ï¼‰
for param in model.backbone.parameters():
    param.requires_grad = False

# 3. æ·»åŠ åˆ†ç±»å¤´
num_classes = 10  # CIFAR-10 æœ‰ 10 ä¸ªç±»åˆ«
classifier = nn.Linear(128, num_classes).to(device)

# 4. å®šä¹‰è®­ç»ƒæµç¨‹
def train_classifier(model, classifier, train_loader, epochs=10):
    optimizer = optim.Adam(classifier.parameters(), lr=0.001)
    criterion = nn.CrossEntropyLoss()
    
    for epoch in range(epochs):
        for images, labels in train_loader:
            images, labels = images.to(device), labels.to(device)
            
            # æå–ç‰¹å¾ï¼ˆå†»ç»“ï¼‰
            with torch.no_grad():
                features = model(images)
            
            # åˆ†ç±»
            outputs = classifier(features)
            loss = criterion(outputs, labels)
            
            # åå‘ä¼ æ’­
            optimizer.zero_grad()
            loss.backward()
            optimizer.step()
        
        print(f"Epoch {epoch+1}/{epochs}, Loss: {loss.item():.4f}")

# 5. è®­ç»ƒåˆ†ç±»å™¨
train_classifier(model, classifier, train_loader)
```

### çº¿æ€§è¯„ä¼°ï¼ˆæ¨èï¼‰

```python
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score

# 1. æå–è®­ç»ƒé›†ç‰¹å¾
X_train, y_train = extract_features(model, train_loader)

# 2. æå–æµ‹è¯•é›†ç‰¹å¾
X_test, y_test = extract_features(model, test_loader)

# 3. è®­ç»ƒé€»è¾‘å›å½’åˆ†ç±»å™¨
clf = LogisticRegression(max_iter=1000, random_state=42)
clf.fit(X_train, y_train)

# 4. è¯„ä¼°
y_pred = clf.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)
print(f"çº¿æ€§è¯„ä¼°å‡†ç¡®ç‡: {accuracy * 100:.2f}%")
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: è®­ç»ƒæ—¶å‡ºç° "RuntimeError: An attempt has been made to start a new process..."

**åŸå› **: Windows ä¸Šçš„å¤šè¿›ç¨‹é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ `simple_run.py` ä¸­è®¾ç½® `self.workers = 0`
2. ç¡®ä¿ä»£ç åœ¨ `if __name__ == '__main__':` ä¿æŠ¤ä¸‹è¿è¡Œ

### Q2: æ§åˆ¶å°è¾“å‡ºä¹±ç 

**åŸå› **: Windows æ§åˆ¶å°ç¼–ç é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. âœ… ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬ï¼ˆå·²åŒ…å«ç¼–ç ä¿®å¤ï¼‰
2. âœ… æ‰¹å¤„ç†æ–‡ä»¶å·²åŒ…å« `chcp 65001` è®¾ç½®
3. âœ… Python è„šæœ¬å·²æ·»åŠ  UTF-8 ç¼–ç è®¾ç½®

### Q3: CUDA out of memory

**åŸå› **: GPU å†…å­˜ä¸è¶³ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```python
# å‡å°æ‰¹æ¬¡å¤§å°
self.batch_size = 32  # æˆ–æ›´å°

# æˆ–ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯
# åœ¨ simclr.py ä¸­å®ç°æ¢¯åº¦ç´¯ç§¯
```

### Q4: è®­ç»ƒå¤ªæ…¢

**ä¼˜åŒ–å»ºè®®**:
1. âœ… å¢å¤§æ‰¹æ¬¡å¤§å°ï¼ˆå¦‚æœGPUå†…å­˜å…è®¸ï¼‰
2. âœ… ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒï¼š`self.fp16_precision = True`
3. âœ… å‡å°‘æ—¥å¿—é¢‘ç‡ï¼š`self.log_every_n_steps = 100`
4. âœ… å…³é—­ cudnn benchmarkï¼š`cudnn.benchmark = False`

### Q5: å‡†ç¡®ç‡ä¸ºä»€ä¹ˆè¿™ä¹ˆä½ï¼Ÿ

**è¿™æ˜¯æ­£å¸¸çš„ï¼**
- SimCLR çš„å‡†ç¡®ç‡æ˜¯å¯¹æ¯”å­¦ä¹ ä»»åŠ¡çš„å‡†ç¡®ç‡
- ä¸æ˜¯æœ€ç»ˆçš„åˆ†ç±»å‡†ç¡®ç‡
- è¦è¯„ä¼°çœŸå®æ€§èƒ½ï¼Œéœ€è¦è¿›è¡Œçº¿æ€§è¯„ä¼°

### Q6: è®­ç»ƒå¤šå°‘ä¸ª epochs æ‰å¤Ÿï¼Ÿ

**æ¨èè½®æ•°**:
- **å¿«é€Ÿæµ‹è¯•**: 2-10 epochs
- **ä¸€èˆ¬è®­ç»ƒ**: 100-200 epochs
- **é«˜è´¨é‡è¡¨ç¤º**: 500-1000 epochs
- **è®ºæ–‡å¤ç°**: 1000 epochs

### Q7: å¦‚ä½•æ¢å¤ä¸­æ–­çš„è®­ç»ƒï¼Ÿ

```python
# åœ¨ run.py ä¸­æ·»åŠ æ£€æŸ¥ç‚¹æ¢å¤
if os.path.exists(checkpoint_path):
    checkpoint = torch.load(checkpoint_path)
    model.load_state_dict(checkpoint['state_dict'])
    optimizer.load_state_dict(checkpoint['optimizer'])
    start_epoch = checkpoint['epoch']
```

### Q8: æ•°æ®é›†ä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ‰‹åŠ¨ä¸‹è½½æ•°æ®é›†
2. æ”¾åˆ° `./datasets/` ç›®å½•
3. æˆ–ä½¿ç”¨å›½å†…é•œåƒ

```python
# ä½¿ç”¨æ¸…åé•œåƒ
import os
os.environ['TORCH_HOME'] = 'path/to/custom/cache'
```

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒè®­ç»ƒæ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `run.py` | åŸå§‹è®­ç»ƒè„šæœ¬ | å®Œæ•´å‚æ•°æ§åˆ¶çš„è®­ç»ƒ |
| `simple_run.py` | ç®€åŒ–è®­ç»ƒè„šæœ¬ | å¿«é€Ÿæµ‹è¯•ï¼ŒWindows å‹å¥½ |
| `simclr.py` | SimCLR è®­ç»ƒé€»è¾‘ | æ ¸å¿ƒå¯¹æ¯”å­¦ä¹ å®ç° |
| `utils.py` | å·¥å…·å‡½æ•° | ä¿å­˜æ£€æŸ¥ç‚¹ã€è®¡ç®—å‡†ç¡®ç‡ç­‰ |

### æ¨¡å‹å’Œæ•°æ®

| æ–‡ä»¶/ç›®å½• | è¯´æ˜ |
|-----------|------|
| `models/resnet_simclr.py` | ResNet backbone + æŠ•å½±å¤´ |
| `data_aug/contrastive_learning_dataset.py` | æ•°æ®é›†åŠ è½½å’Œå¢å¼º |
| `data_aug/gaussian_blur.py` | é«˜æ–¯æ¨¡ç³Šå¢å¼º |
| `data_aug/view_generator.py` | ç”Ÿæˆå¯¹æ¯”å­¦ä¹ çš„å¤šè§†å›¾ |

### è¾…åŠ©è„šæœ¬

| æ–‡ä»¶ | è¯´æ˜ | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| `run_simclr.bat` | ä¸€é”®è®­ç»ƒå¯åŠ¨ | `.\run_simclr.bat` |
| `start_tensorboard.bat` | å¯åŠ¨ TensorBoard | `.\start_tensorboard.bat` |
| `check_env.py` | ç¯å¢ƒæ£€æŸ¥ | `python check_env.py` |
| `view_results.py` | æŸ¥çœ‹è®­ç»ƒç»“æœæ‘˜è¦ | `python view_results.py` |
| `analyze_results.py` | è¯¦ç»†åˆ†ææ¨¡å‹ | `python analyze_results.py` |

### ç»“æœæ–‡ä»¶

| ç›®å½•/æ–‡ä»¶ | è¯´æ˜ |
|-----------|------|
| `runs/*/checkpoint_*.pth.tar` | æ¨¡å‹æ£€æŸ¥ç‚¹ï¼ˆåŒ…å«æƒé‡å’Œä¼˜åŒ–å™¨çŠ¶æ€ï¼‰|
| `runs/*/training.log` | è®­ç»ƒæ–‡æœ¬æ—¥å¿— |
| `runs/*/events.out.tfevents.*` | TensorBoard äº‹ä»¶æ–‡ä»¶ |
| `datasets/` | ä¸‹è½½çš„æ•°æ®é›†å­˜å‚¨ä½ç½® |

### æ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `TRAINING_RESULTS.md` | è®­ç»ƒç»“æœæ€»ç»“ |
| `README.md` | é¡¹ç›®è¯´æ˜ |
| `LICENSE.txt` | è®¸å¯è¯ |

---

## ğŸ“ æ·±å…¥å­¦ä¹ 

### SimCLR åŸç†

1. **æ•°æ®å¢å¼º**: å¯¹åŒä¸€å›¾åƒåº”ç”¨ä¸¤ç§ä¸åŒçš„å¢å¼ºï¼Œç”Ÿæˆæ­£æ ·æœ¬å¯¹
2. **ç¼–ç å™¨**: ResNet æå–ç‰¹å¾
3. **æŠ•å½±å¤´**: éçº¿æ€§å˜æ¢åˆ°å¯¹æ¯”ç©ºé—´
4. **å¯¹æ¯”æŸå¤±**: NT-Xentï¼ˆå½’ä¸€åŒ–æ¸©åº¦ç¼©æ”¾äº¤å‰ç†µï¼‰æŸå¤±

### å…³é”®è¶…å‚æ•°

- **Temperature (Ï„)**: æ§åˆ¶ç›¸ä¼¼åº¦åˆ†å¸ƒçš„é”åº¦
  - è¾ƒå°çš„å€¼ (0.05-0.07) â†’ æ›´é›†ä¸­çš„åˆ†å¸ƒ
  - è¾ƒå¤§çš„å€¼ (0.1-0.5) â†’ æ›´å¹³æ»‘çš„åˆ†å¸ƒ

- **Batch Size**: è¶Šå¤§è¶Šå¥½ï¼ˆæä¾›æ›´å¤šè´Ÿæ ·æœ¬ï¼‰
  - æ¨è: 256-8192
  - é™åˆ¶: GPU å†…å­˜

- **Learning Rate**: 
  - å…¬å¼: `lr = 0.3 * batch_size / 256`
  - ä¾‹å¦‚: batch_size=128 â†’ lr=0.15

### è¯„ä¼°æ–¹æ³•

1. **çº¿æ€§è¯„ä¼°** (Linear Evaluation)
   - å†»ç»“ç¼–ç å™¨
   - è®­ç»ƒçº¿æ€§åˆ†ç±»å™¨
   - è¯„ä¼°åˆ†ç±»å‡†ç¡®ç‡

2. **å¾®è°ƒ** (Fine-tuning)
   - è§£å†»ç¼–ç å™¨
   - ç«¯åˆ°ç«¯è®­ç»ƒ
   - é€šå¸¸æ€§èƒ½æ›´å¥½

3. **è¿ç§»å­¦ä¹ ** (Transfer Learning)
   - åœ¨æ–°æ•°æ®é›†ä¸Šåº”ç”¨é¢„è®­ç»ƒç‰¹å¾
   - è¯„ä¼°æ³›åŒ–èƒ½åŠ›

### å‚è€ƒèµ„æº

- ğŸ“„ **åŸå§‹è®ºæ–‡**: [A Simple Framework for Contrastive Learning of Visual Representations](https://arxiv.org/abs/2002.05709)
- ğŸ’» **å®˜æ–¹å®ç°**: [google-research/simclr](https://github.com/google-research/simclr)
- ğŸ“š **æœ¬é¡¹ç›®æ¥æº**: [sthalles/SimCLR](https://github.com/sthalles/SimCLR)

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. âœ… æ£€æŸ¥æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. âœ… è¿è¡Œ `check_env.py` éªŒè¯ç¯å¢ƒ
3. âœ… æŸ¥çœ‹ `runs/*/training.log` æ—¥å¿—æ–‡ä»¶
4. âœ… æ£€æŸ¥ GitHub Issues

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```powershell
# === ç¯å¢ƒç®¡ç† ===
conda activate simclr_pytorch              # æ¿€æ´»ç¯å¢ƒ
conda deactivate                           # é€€å‡ºç¯å¢ƒ
python check_env.py                        # æ£€æŸ¥ç¯å¢ƒ

# === è®­ç»ƒ ===
.\run_simclr.bat                          # ä¸€é”®è®­ç»ƒï¼ˆæ¨èï¼‰
python simple_run.py                       # ç®€åŒ–è®­ç»ƒ
python run.py -data ./datasets -dataset-name cifar10 --epochs 100  # å®Œæ•´è®­ç»ƒ

# === æŸ¥çœ‹ç»“æœ ===
.\start_tensorboard.bat                    # å¯åŠ¨ TensorBoard
python view_results.py                     # æŸ¥çœ‹è®­ç»ƒæ‘˜è¦
python analyze_results.py                  # è¯¦ç»†åˆ†æ
type .\runs\*\training.log                # æŸ¥çœ‹æ—¥å¿—

# === æ¸…ç† ===
Remove-Item -Recurse -Force .\runs\*      # åˆ é™¤æ‰€æœ‰è®­ç»ƒç»“æœ
Remove-Item -Recurse -Force .\datasets\*  # åˆ é™¤æ•°æ®é›†ï¼ˆéœ€é‡æ–°ä¸‹è½½ï¼‰
```

---

**ç¥è®­ç»ƒé¡ºåˆ©ï¼ ğŸš€**

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆï¼
